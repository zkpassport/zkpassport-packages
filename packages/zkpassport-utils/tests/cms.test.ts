import { AsnParser, SignerInfo } from "../src/cms/asn"
import { getSubjectKeyIdFromSignerInfo } from "../src/cms/utils"

describe("CMS", () => {
  describe("ASN", () => {
    it("should get ski from signer info", () => {
      const signerInfo = AsnParser.parse(
        new Uint8Array([
          48, 130, 1, 13, 2, 1, 3, 128, 20, 83, 176, 242, 41, 211, 162, 0, 109, 200, 24, 193, 208,
          27, 157, 67, 48, 189, 168, 59, 111, 48, 11, 6, 9, 96, 134, 72, 1, 101, 3, 4, 2, 1, 160,
          129, 144, 48, 21, 6, 9, 42, 134, 72, 134, 247, 13, 1, 9, 3, 49, 8, 6, 6, 103, 129, 8, 1,
          1, 2, 48, 28, 6, 9, 42, 134, 72, 134, 247, 13, 1, 9, 5, 49, 15, 23, 13, 50, 53, 48, 55,
          48, 57, 48, 54, 52, 54, 51, 54, 90, 48, 40, 6, 9, 42, 134, 72, 134, 247, 13, 1, 9, 52, 49,
          27, 48, 25, 48, 11, 6, 9, 96, 134, 72, 1, 101, 3, 4, 2, 1, 161, 10, 6, 8, 42, 134, 72,
          206, 61, 4, 3, 2, 48, 47, 6, 9, 42, 134, 72, 134, 247, 13, 1, 9, 4, 49, 34, 4, 32, 225,
          28, 153, 105, 41, 194, 26, 226, 200, 210, 77, 209, 244, 65, 237, 230, 193, 193, 115, 92,
          150, 77, 1, 103, 144, 79, 166, 151, 237, 209, 177, 18, 48, 10, 6, 8, 42, 134, 72, 206, 61,
          4, 3, 2, 4, 70, 48, 68, 2, 32, 101, 133, 50, 216, 140, 205, 5, 110, 209, 68, 175, 14, 51,
          18, 245, 181, 45, 210, 127, 79, 208, 146, 34, 225, 237, 237, 251, 127, 81, 44, 46, 156, 2,
          32, 120, 169, 100, 59, 82, 230, 254, 75, 151, 168, 37, 148, 23, 55, 128, 181, 233, 59, 64,
          221, 2, 26, 82, 130, 109, 188, 140, 39, 224, 164, 149, 19,
        ]),
        SignerInfo,
      )
      const ski = getSubjectKeyIdFromSignerInfo(signerInfo)
      expect(ski).toEqual("0x53b0f229d3a2006dc818c1d01b9d4330bda83b6f")
    })
  })
})
